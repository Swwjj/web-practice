<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.webproj.mapper.AddressMapper">

    <select id="findById" resultType="com.example.webproj.pojo.Address">
        SELECT id, user_id AS userId, name, phone, mobile, province, city, district,
               addr, zip, `dfault` AS dfault, isDel, created, updated
        FROM address
        WHERE id = #{id} AND isDel = 0
    </select>

    <select id="findByUserId" resultType="com.example.webproj.pojo.Address">
        SELECT id, user_id AS userId, name, phone, mobile, province, city, district,
               addr, zip, `dfault` AS dfault, isDel, created, updated
        FROM address
        WHERE user_id = #{userId} AND isDel = 0
        ORDER BY `dfault` DESC, updated DESC
    </select>

    <update id="updateAddress">
        UPDATE address
        SET name = #{name},
            phone = #{phone},
            mobile = #{mobile},
            province = #{province},
            city = #{city},
            district = #{district},
            addr = #{addr},
            zip = #{zip},
            updated = #{updated}
        WHERE id = #{id} AND user_id = #{userId} AND isDel = 0
    </update>

    <update id="setDefaultAddress">
        UPDATE address
        SET `dfault` = 1,
            updated = NOW()
        WHERE id = #{id} AND user_id = #{userId} AND isDel = 0
    </update>

    <update id="resetDefaultAddress">
        UPDATE address
        SET `dfault` = 0
        WHERE user_id = #{userId} AND isDel = 0
    </update>

    <update id="deleteAddress">
        UPDATE address
        SET isDel = 1,
            updated = NOW()
        WHERE id = #{id} AND user_id = #{userId} AND isDel = 0
    </update>

    <insert id="insertAddress" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO address (
            user_id, name, phone, mobile, province, city, district,
            addr, zip, `dfault`, isDel, created, updated
        ) VALUES (
                     #{userId}, #{name}, #{phone}, #{mobile}, #{province}, #{city}, #{district},
                     #{addr}, #{zip}, #{dfault}, #{isDel}, #{created}, #{updated}
                 )
    </insert>
</mapper>
